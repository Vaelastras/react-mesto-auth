{"ast":null,"code":"var _jsxFileName = \"/Users/vaelastras/Yandex/react-mesto-auth/src/components/App.js\";\nimport React from 'react';\nimport Header from \"./Header\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport EditProfilePopup from './EditProfilePopup';\nimport ImagePopup from \"./ImagePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport { api } from '../utils/Api';\nimport { CurrentUserContext } from '../context/CurrentUserContext';\nimport PopupDelete from \"./PopupDelete\";\nimport Login from \"./Login\";\nimport InfoTooltip from \"./InfoTooltip\";\n\nfunction App() {\n  // стейты попапов\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(false);\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n  const [isDeletePopupOpen, setIsDeletePopupOpen] = React.useState(false);\n  const [selectedCard, setSelectedCard] = React.useState(false);\n  const [cards, setCards] = React.useState([]);\n  const [cardDelete, setCardDelete] = React.useState([]);\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [isLoading, setIsLoading] = React.useState(false); // effects block code\n\n  React.useEffect(() => {\n    api.getInfoFromServer().then(([userData, initialCards]) => {\n      setCurrentUser(userData);\n      setCards(initialCards);\n    }).catch(err => console.log(err));\n  }, []);\n  React.useEffect(() => {\n    document.addEventListener('keydown', handleEscapeClose);\n    document.addEventListener(\"mousedown\", handleOverlayClose);\n    return () => {\n      document.removeEventListener('keydown', handleEscapeClose);\n      document.removeEventListener(\"mousedown\", handleOverlayClose);\n    };\n  }); // close handlers\n\n  function handleEscapeClose(e) {\n    if (e.key === 'Escape') {\n      closeAllPopups();\n    }\n  }\n\n  function handleOverlayClose(e) {\n    if (e.target.classList.contains('popup')) {\n      closeAllPopups();\n    }\n  }\n\n  function closeAllPopups() {\n    setIsEditAvatarPopupOpen(false);\n    setIsEditProfilePopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setIsDeletePopupOpen(false);\n    setSelectedCard(false);\n  } //setstate block\n\n\n  function handleEditAvatarClick() {\n    setIsEditAvatarPopupOpen(true);\n  }\n\n  function handleEditProfileClick() {\n    setIsEditProfilePopupOpen(true);\n  }\n\n  function handleAddPlaceClick() {\n    setIsAddPlacePopupOpen(true);\n  }\n\n  function handleCardClick(card) {\n    setSelectedCard(card);\n  }\n\n  function handleDeleteCardClick() {\n    setIsDeletePopupOpen(true);\n  } // fetch handlers\n\n\n  function handleUpdateUser(data) {\n    setIsLoading(true);\n    api.patchUserProfile(data).then(res => {\n      setCurrentUser(res);\n      setIsLoading(false);\n      closeAllPopups();\n    }).catch(err => console.log(err));\n  }\n\n  function handleUpdateAvatar(data) {\n    setIsLoading(true);\n    api.patchAvatar(data).then(res => {\n      setCurrentUser(res);\n      setIsLoading(false);\n      closeAllPopups();\n    }).catch(err => console.log(err));\n  }\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n\n    if (!isLiked) {\n      api.putLike(card._id).then(newCard => {\n        const newCards = cards.map(c => c._id === card._id ? newCard : c);\n        setCards(newCards);\n      }).catch(err => console.log(err));\n    } else {\n      api.deleteLike(card._id).then(newCard => {\n        const newCards = cards.map(c => c._id === card._id ? newCard : c);\n        setCards(newCards);\n      }).catch(err => console.log(err));\n    }\n  }\n\n  function handleConfirmCardDelete() {\n    const isOwn = cardDelete.owner._id === currentUser._id;\n    setIsLoading(true);\n    api.deleteCard(cardDelete._id, !isOwn).then(newCard => {\n      // Обновляем стейт\n      setCards(cards.filter(c => c._id === cardDelete._id ? !newCard : c));\n      setIsLoading(false);\n      closeAllPopups();\n    }).catch(err => console.log(err));\n  }\n\n  function handleCardDelete(card) {\n    setCardDelete(card);\n    handleDeleteCardClick();\n  }\n\n  function handleAddPlaceSubmit(item) {\n    api.postUserCard(item).then(res => {\n      setCards([...cards, res]);\n      closeAllPopups();\n    }).catch(err => console.log(err));\n  }\n\n  return /*#__PURE__*/React.createElement(CurrentUserContext.Provider, {\n    value: currentUser,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"page\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"root\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Header, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(InfoTooltip, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(Login, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(Main, {\n    cards: cards,\n    onEditAvatar: handleEditAvatarClick,\n    onEditProfile: handleEditProfileClick,\n    onAddPlace: handleAddPlaceClick,\n    onCardClick: handleCardClick,\n    onCardLike: handleCardLike,\n    onCardDelete: handleCardDelete,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(EditProfilePopup, {\n    isOpen: isEditProfilePopupOpen,\n    onClose: closeAllPopups,\n    onUpdateUser: handleUpdateUser,\n    isLoading: isLoading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(AddPlacePopup, {\n    isOpen: isAddPlacePopupOpen,\n    onClose: closeAllPopups,\n    onAddPlace: handleAddPlaceSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 10\n    }\n  }), /*#__PURE__*/React.createElement(EditAvatarPopup, {\n    isOpen: isEditAvatarPopupOpen,\n    onClose: closeAllPopups,\n    onUpdateAvatar: handleUpdateAvatar,\n    isLoading: isLoading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(ImagePopup, {\n    card: selectedCard,\n    isClose: closeAllPopups,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(PopupDelete, {\n    isOpen: isDeletePopupOpen,\n    onClose: closeAllPopups,\n    onSubmit: handleConfirmCardDelete,\n    isLoading: isLoading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 11\n    }\n  }))));\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/vaelastras/Yandex/react-mesto-auth/src/components/App.js"],"names":["React","Header","Main","Footer","EditProfilePopup","ImagePopup","EditAvatarPopup","AddPlacePopup","api","CurrentUserContext","PopupDelete","Login","InfoTooltip","App","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","useState","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isDeletePopupOpen","setIsDeletePopupOpen","selectedCard","setSelectedCard","cards","setCards","cardDelete","setCardDelete","currentUser","setCurrentUser","isLoading","setIsLoading","useEffect","getInfoFromServer","then","userData","initialCards","catch","err","console","log","document","addEventListener","handleEscapeClose","handleOverlayClose","removeEventListener","e","key","closeAllPopups","target","classList","contains","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleCardClick","card","handleDeleteCardClick","handleUpdateUser","data","patchUserProfile","res","handleUpdateAvatar","patchAvatar","handleCardLike","isLiked","likes","some","i","_id","putLike","newCard","newCards","map","c","deleteLike","handleConfirmCardDelete","isOwn","owner","deleteCard","filter","handleCardDelete","handleAddPlaceSubmit","item","postUserCard"],"mappings":"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","sourcesContent":["import React from 'react';\nimport Header from \"./Header\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport EditProfilePopup from './EditProfilePopup'\nimport ImagePopup from \"./ImagePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\n\nimport {api} from '../utils/Api'\nimport {CurrentUserContext} from '../context/CurrentUserContext'\nimport PopupDelete from \"./PopupDelete\";\nimport Login from \"./Login\";\nimport InfoTooltip from \"./InfoTooltip\";\n\nfunction App () {\n\n  // стейты попапов\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(false);\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n  const [isDeletePopupOpen, setIsDeletePopupOpen] =React.useState(false);\n  const [selectedCard, setSelectedCard] = React.useState(false); \n  const [cards, setCards] = React.useState([]);\n  const [cardDelete, setCardDelete] =React.useState([]);\n  const [currentUser, setCurrentUser] = React.useState({})\n  const [isLoading, setIsLoading] = React.useState(false)\n\n\n  // effects block code\n  React.useEffect(() => {\n    api.getInfoFromServer()\n      .then(([userData, initialCards]) => {\n        setCurrentUser(userData)\n        setCards(initialCards)\n    })\n    .catch(err => console.log(err));\n  }, [])\n\n  React.useEffect(()=> {\n    document.addEventListener('keydown', handleEscapeClose)\n    document.addEventListener(\"mousedown\", handleOverlayClose)\n\n    return () =>{\n      document.removeEventListener('keydown', handleEscapeClose)\n      document.removeEventListener(\"mousedown\", handleOverlayClose )\n    }\n  })\n\n  // close handlers\n\n  function handleEscapeClose(e) {\n    if (e.key === 'Escape') {\n      closeAllPopups()\n    }\n  }\n\n  function handleOverlayClose(e) {\n    if (e.target.classList.contains('popup')) {\n      closeAllPopups()\n    }\n  }\n\n  function closeAllPopups() {\n    setIsEditAvatarPopupOpen(false);\n    setIsEditProfilePopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setIsDeletePopupOpen(false)\n    setSelectedCard(false);\n  }\n\n  //setstate block\n\n  function handleEditAvatarClick () {\n    setIsEditAvatarPopupOpen(true);\n  }\n\n  function handleEditProfileClick() {\n    setIsEditProfilePopupOpen(true);\n  }\n\n  function handleAddPlaceClick() {\n    setIsAddPlacePopupOpen(true);\n  }\n\n  function handleCardClick(card) {\n    setSelectedCard(card);\n  }\n\n  function handleDeleteCardClick() {\n    setIsDeletePopupOpen(true)\n  }\n\n // fetch handlers\n  function handleUpdateUser(data) {\n    setIsLoading(true)\n    api.patchUserProfile(data)\n      .then((res) => {\n        setCurrentUser(res)\n        setIsLoading(false)\n        closeAllPopups()\n      }\n    )\n    .catch(err => console.log(err));\n  }\n\n  function handleUpdateAvatar(data) {\n    setIsLoading(true)\n    api.patchAvatar(data)\n      .then((res) => {\n        setCurrentUser(res)\n        setIsLoading(false)\n        closeAllPopups();\n      }\n    )\n    .catch(err => console.log(err));\n  }\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n\n    if (!isLiked) {\n      api.putLike(card._id)\n        .then((newCard) => {\n          const newCards = cards.map((c) => c._id === card._id ? newCard : c)\n          setCards(newCards)\n        })\n        .catch(err => console.log(err));\n\n    } else {\n      api.deleteLike(card._id)\n        .then((newCard) => {\n          const newCards = cards.map((c) => c._id === card._id ? newCard : c)\n          setCards(newCards)\n        })\n        .catch(err => console.log(err));\n    }\n  }\n\n  function handleConfirmCardDelete() {\n    const isOwn = cardDelete.owner._id === currentUser._id;\n    setIsLoading(true)\n    api.deleteCard(cardDelete._id, !isOwn)\n      .then((newCard) => {\n                // Обновляем стейт\n        setCards(cards.filter((c) => c._id === cardDelete._id ? !newCard : c));\n        setIsLoading(false)\n        closeAllPopups()\n      })\n      .catch(err => console.log(err));\n\n  }\n\n  function handleCardDelete(card) {\n    setCardDelete(card);\n    handleDeleteCardClick();\n  }\n\n  function handleAddPlaceSubmit(item){\n    api.postUserCard(item)\n      .then((res) => {\n        setCards([...cards, res]);\n        closeAllPopups()\n        }\n      )\n      .catch(err => console.log(err));\n  }\n\n\n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n      <div className=\"page\">\n        <div className=\"root\">\n          <Header />\n          <InfoTooltip/>\n\n          <Login/>\n          <Main\n            cards={cards}\n            onEditAvatar={handleEditAvatarClick}\n            onEditProfile={handleEditProfileClick}\n            onAddPlace ={handleAddPlaceClick}\n            onCardClick={handleCardClick}\n            onCardLike={handleCardLike}\n            onCardDelete={handleCardDelete}\n          />\n          <Footer />\n\n          <EditProfilePopup\n            isOpen={isEditProfilePopupOpen}\n            onClose={closeAllPopups}\n            onUpdateUser={handleUpdateUser}\n            isLoading={isLoading}\n          />\n\n         <AddPlacePopup\n           isOpen={isAddPlacePopupOpen}\n           onClose={closeAllPopups}\n           onAddPlace={handleAddPlaceSubmit}\n         />\n\n          <EditAvatarPopup\n            isOpen={isEditAvatarPopupOpen}\n            onClose={closeAllPopups}\n            onUpdateAvatar={handleUpdateAvatar}\n            isLoading={isLoading}\n          />\n\n          <ImagePopup\n            card={selectedCard}\n            isClose={closeAllPopups}\n          />\n\n          <PopupDelete\n            isOpen={isDeletePopupOpen}\n            onClose={closeAllPopups}\n            onSubmit={handleConfirmCardDelete}\n            isLoading={isLoading}\n          />\n        </div>\n      </div>\n    </CurrentUserContext.Provider>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}